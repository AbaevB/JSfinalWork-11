# JSfinalWork-11

Черновик финальной работы по курсу JavaScript

## Техническое задание на разработку

Сайт представляет собой интернет-магазин светильников Briaton, в котором пользователи могут просматривать каталог товаров, выбирать светильники и добавлять их в корзину для последующего оформления и оплаты заказа.

При нажатии на бургерное меню «Каталог» выпадает список, в котором можно выбрать нужную категорию товаров и перейти на соответствующую страницу каталога..

На странице каталога доступна функция выбора города, с помощью которой можно указать один из доступных вариантов.

Для удобства покупателя на странице есть фильтрация товаров по различным критериям: типу светильников и наличию товара на складе. Также пользователь может сортировать товары по цене (от дорогих к дешёвым и наоборот) и популярности. Если товаров слишком много, сайт автоматически включает пагинацию, разбивая список продуктов на страницы. Это позволяет просматривать часть товаров, выбирая нужную страницу.

Добавленные в корзину товары отображаются в соответствующем разделе, в котором можно просмотреть их количество и стоимость. Кроме того, на сайте есть блок с часто задаваемыми вопросами, представленный в формате аккордеона: по клику на вопрос раскрывается ответ.

Каждая карточка товара загружается динамически с сервера, что обеспечивает актуальность данных. При наведении на элемент карточки с символом i всплывает подсказка, в которой указано наличие товара в каждом доступном городе.

Для товаров дня предусмотрен интерактивный слайдер, который позволяет пролистать актуальные предложения. Помимо этого, на сайте есть форма обратной связи, через которую можно отправить запрос на консультацию. При успешной отправке формы пользователь увидит подтверждающее сообщение о том, что заявка была успешно отправлена.

### Необходимые инструменты

- [Макет Figma](https://www.figma.com/design/LwQ6blgDCgM4NoNXeXiRpO/Skillbox-%C3%97-AffArts-%3A%3A-Briaton?node-id=0-1&t=P3an92eAD3cssD5h-1)

- [Критерии оценки](https://docs.google.com/spreadsheets/d/1AI8RXjGyBKhY__A40nk83MNmE3S6bB4EKjyQNzG2630/edit?gid=0#gid=0)

### Технические требования

- [x] Открытие/закрытие бургерного меню каталога сайта.

- [x] Открытие/закрытие выпадающего меню для выбора города с возможностью смены варианта по клику на соответствующий пункт.

- [x] Отрисовка карточек товаров с помощью JavaScript на основе данных из внешнего файла data.json

- [x] Отображение количества товаров в соответствующей категории рядом с каждым фильтром (чекбоксом) в форме.

- [x] Фильтрация товаров на основе выбранных фильтров формы с возможностью сортировки по типу и наличию товара.
- [x] Сортировка карточек товаров по трём параметрам: дорогие, дешёвые, популярные.

- [x] Добавление/удаление товаров в корзине и отображение содержимого корзины на сайте.

- [x] Функционал аккордеона в блоке «Ответы на частые вопросы».

- [x] Слайдер в блоке «Товары дня», созданный с помощью библиотеки Swiper.js.

- [x] Валидация формы в блоке «Обратитесь к нам» с помощью библиотеки Just Validate.

- [x] Отправка формы на сервер по адресу: (<https://httpbin.org/post>)

## Инструкции по использованию инфраструктуры

- В папке **css** хранится стилевой файл style.css, который получается при компиляции SCSS и подключается в теге **head** на странице проекта **catalog.html**.

- В папке **data** находится файл **data.json**, который имитирует сервер. Также в файле хранятся данные для карточек товаров.

- В папке **fonts** — шрифты проекта.

- В папке **images** хранятся изображения и иконки для спрайтов.

- Папка **js** — основная папка, в которой вам предстоит работать. Внутри есть файл **main.js**, к которому нужно подключить все модули из папки **components**.

  - Папка **components** предназначена для хранения модулей, каждый из которых содержит отдельный функциональный блок. В этих модулях необходимо написать код, реализующий конкретные компоненты, которые используются на страницах проекта. Каждый файл должен быть независимым и отвечать за одну часть интерфейса, например за кнопки, формы или выпадающие меню.

  - Папка **vendor** хранит внешние библиотеки. Всё, что вам нужно для работы, уже добавлено в папку и подключено к проекту.

- В папке **scss** хранятся файлы стилей, написанные с использованием препроцессора SCSS.

- Файл **catalog.html** — основной файл разметки для страницы каталога. В нём содержится структура HTML, которая отвечает за отображение всех элементов интерфейса каталога.

### Что можно добавить

Это дополнительные задачи, которые вы можете решить, чтобы улучшить проект.

- [] Работа пагинации на страницы каталога.

- [x] Всплывающие подсказки на каждой карточке товара с использованием библиотеки Tippy.js.

## Этапы выполнения задания

### 1. Открытие/закрытие бургерного меню каталога сайта

> Для обращения к элементам DOM по *id* были добавлены соответствующие атрибуты для кнопки открытия меню, самог тега меню и кнопки закрытия меню.

- Файл *js/components/burger.js* содержит функцию открытия/закрытия бургерного меню, экспортированную в файл *js/main.js*.

- При клике на кнопку открывается бургерное меню и блокируется скролл страницы.

- При клике на кнопку закрытия меню или одну из ссылок внутри него скролл разблокируется, и меню исчезает.

### 2. Открытие/закрытие выпадающего меню для выбора города с возможностью смены варианта по клику на соответствующий пункт

- Был реализован доступ по *id* для кнопки смены локации и текстового элемента.

- функция `changeLocation()` из файла *js/components/changeLocation.js* экспортирована в *js/main.js* и вызывается в нем при загрузке DOM

- При клике на кнопку смены локации открывается список городов.

- При клике на одну из позиций списка или при клике вне списка список закрывается.

- Выбранная локация отображается в кнопке выбора локации.

Была выполнена проверка на соответствие выполненной работы пунктам [технических требований](https://docs.google.com/spreadsheets/d/1iISHb9GMAkXbi2Gl2HiLEHMAwyNKLhB5TueYetmbxIg/edit?gid=0#gid=0) . Создан пулл реквест.

### 3. Отрисовка карточек товаров с помощью JavaScript на основе данных из внешнего файла data.json

> Для обращения к элементам DOM по *id* были добавлены соответствующие атрибуты для тега `<ul id="catalogList" class="catalog__list">`

- Создание класса карточки из шаблона *template* `#ProductCard` в файле `js/components/ProsuctCard.js`

- Файл `/home/andrew/git/javaScript-new/js/components/catalog.js` содержит экспортированную в `main.js` функцию `catalog()` которая создает экземпляры класса на основе данных из файла *data/data.json*

- Была выполнена проверка на соответствие выполненной работы пунктам [технических требований](https://docs.google.com/spreadsheets/d/1iISHb9GMAkXbi2Gl2HiLEHMAwyNKLhB5TueYetmbxIg/edit?gid=0#gid=0) . Создан пулл реквест.

### 4 Фильтрация и сортировка карточек

> Эта задача состоит из трех подзадач:

- Отображение количества товаров в соответствующей категории рядом с каждым фильтром (чекбоксом) в форме.

- Фильтрация товаров на основе выбранных фильтров формы с возможностью сортировки по типу и наличию товара.

- Сортировка карточек товаров по трём параметрам: дорогие, дешёвые, популярные.

#### Отображение количества товаров

Функция `updateFiltersCount()` получает данные о товарах из JSON файла и обновляет данные возле каждого чекбокса. Функция прописана в *js/components/updateFiltersCount.js* и импортирована в *main.js*

#### Фильтрация

 Фильтрация карточек на основе выбранных фильтров формы осуществляется асинхронной функцией `function applyFilters()`, экспортированной из файла *js/components/applyFilters.js*. Функция выполняет запрос к данным из файла *data/data.json*, фильтрует их на основе активных элементов формы, очищает контейнер с карточками `#catalogList` и на основе отфильтрованных данных отрисовывает в контейнере новые карточки.

 > NOTICE! Изменения в верстке - в связи с тем, что очишамый при перерисовке  карточек список полностью очищается этой функцией, шаблон карточки вынесен из верстки в начало тега *body*

### Дополнительно: создание тултипов на нативном JS

 > На стадии подготовки функция, выполняющая запрос к файлу данных была вынесена в отдельный компонент *js/components/fetchData.js*.

 Поскольку тултипы уже присутствуют в верстке, я решил попробовать реализовать их средствами нативного JavaScript, без использования библиотеки **tippyJS**. При необходимости могу позже реализовать их используя эту библиотеку.

Тултипы, всплывающие при наведению на кнопку внутри карточки реализованы в классе *ProductCard* методом *createToolTip*.

### Исправление функции `fetchData`

Чтобы не создавать лишней нагрузки на браузер, функция `fetchData` теперь вызывается один раз, при загрузке страницы, возвращает данные из файла `data/data.json` в виде массива в переменную `data`, с которой и работают функции, использующие данные из JSON

### Функционал корзины

- Создан класс `BasketItem` для представления отдельного элемента корзины, отвечающего за формирование и отрисовку карточки товара в корзине.

- модуль `basket.js` содержит функции для управления корзиной.

- Редактирование класса `ProsuctCard`:
  - Добавление метода `setupAddToBasket`, который добавляет кнопке "В корзину" атрибут `data-id` содержащий id товара из JSON, и добавляет ей обработчик события - функцию добавления товара.

- Обновление счетчика осуществляется функцией `updateBasketCounter`

- Добавление товара в корзину осуществляется методом `addToBasket()` , который вызывает одноименную функцию из `js/components/basket.js`

- Скрытие/отображение кнопки "В корзину" и блока `basket__empty-block` осуществляется добавлением и снятием класса `vsually-hidden`

- Удаление товара реализовано в классе `js/components/BasketItem.js`

- Состояние корзины сохраняется в *localStorage*

### Функционал аккордеона в секции `faq`

Компонент *js/components/accordion.js* содержит обычную для этого элемента `accordion()`, которая экспортирована в *main.js*. При клике на кнопку аккордеона открывается соответствующий блок, и кнопка меняет вид, причем друггие открытые блоки аккордеона закрываются. При клике на активную кнопку она закрывает активный блок и принимает вид по умолчанию.

### Слайдер

Карточка для слайдера реализована при помощи класса *ProductCardDay*, созданного на основе класса *ProductCard*. с использованием другого шаблона `<template id="productCardDayTemplate">`

Функция `slider(data)` компонента *js/components/slider.js* принимает аргументом данные из JSON, выбирает из массива элементы со свойством `"goodsOfDay" : true`, и сохраняет в переменную *filteredData* `let filteredData = data.filter(product => product.goodsOfDay);`. Затем создает элементы слайдера используя эти данные.
Функция `function sliderInit()` в компоненте *js/components/slider.js* инициализирует слайдер используя библиотеку *SwiperJs*.

### Отправка и валидация формы в блоке «Обратитесь к нам»

#### Модальные окна

> Модальные окна, открывающиеся при отправке формы реализованы классом `ModalWindow`, принимающим аргументами id, текст заголовка,  текст сообщения модального окна, и значение атрибута `xlink:href` для иконки.

Отправка формы на [сервер](https://httpbin.org/post) и проверка отправки данных выполняется функцией `questionsForm()` - она создает два экземпляра класса `ModalWindow` (для успешной отправки и для сбоя), и в зависимости от состояния отправки открывает одно из них.

#### Валидация формы при помощи библиотеки JustValidate

Настройка валидации полей формы:

- Имя:
  - Обязательное поле, сообщение - "Введите имя!"
  - Длина не менее 3 симоволов, сообщение - "Имя должно содержать не менее 3 символов!"
- Почта:
  - Обязательное поле, сообщение - "Введите почту!"
  - Формат email, сообщение -  "Почта введена неверно!"
- Чекбокс:
  - Обязательное поле, сообщение - "Вы не согласились с условиями!"

Дополнительная настройка - цвет сообщений  JustValidate заменен на акцентный цвет сайта (#9be198)  в настройках функции `formValidation()`

### Предотвращение стандартного поведения для ссылок

> Для ссылок внутри карточки установлено предотвращение стандартного поведения при клике, чтобы по клику они  лишь добавляли товар в корзину, а не скроллили страницу наверх.

```js
 setupAddToBasket() {
    let addToBasketButton = this.cardElement.querySelector('.product-card__link.btn--icon');
    addToBasketButton.setAttribute('data-id', this.data.id);
    addToBasketButton.addEventListener('click', (event) => {
      event.preventDefault(); // Отменяем переход по ссылке
      this.addToBasket();
    });
  }
```

## Изменения в функционале корзины

- Добавление уникального шестизначного data-атрибута `data-product-id`, каждому элементу (карточке) корзины - это позволяет удалять карточки не по id товара, который может совпадать при добавлении в корзину нескольких одинаковых товаров, а по уникальному id карточки.

- Оптимизация `localStorage` - в `localStorage` теперь сохраняется только уникальный id карточки и id товара из массива данных о товарах.
